<!DOCTYPE html>
<html>
<head>
    <title>{{ course.title }}</title>
    <style>
        .course-detail {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            background-color: #f9f9f9;
        }
        .course-detail img {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            margin-right: 20px;
        }
        .course-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .course-meta {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .course-meta span {
            background-color: #e0f7e9;
            padding: 5px 10px;
            border-radius: 5px;
        }
        .reviews {
            margin-top: 30px;
        }
        .review {
            border-top: 1px solid #ddd;
            padding: 10px 0;
        }
        .review-form {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="course-detail">
        <div class="course-header">
            {% if course.teacher.avatar %}
                <img src="{{ course.teacher.avatar.url }}" alt="Аватар преподавателя">
            {% else %}
                <img src="https://via.placeholder.com/100" alt="Аватар по умолчанию">
            {% endif %}
            <div>
                <h1>{{ course.title }}</h1>
                <p><strong>Преподаватель:</strong> {{ course.teacher.fullname }}</p>
            </div>
        </div>
        <p><strong>Описание:</strong> {{ course.description }}</p>
        <p><strong>Стаж работы:</strong> {{ course.experience }} лет</p>
        <p><strong>Цена:</strong> {{ course.price_per_hour }} KGS/час</p>
        <p><strong>Средняя оценка:</strong> 
            {% with avg_rating=course.get_average_rating %}
                {% if avg_rating %}
                    <span style="color: gold;">★</span> {{ avg_rating }}/5 (на основе {{ course.reviews.count }} отзывов)
                {% else %}
                    Нет отзывов
                {% endif %}
            {% endwith %}
        </p>
        <div class="course-meta">
            <span>{{ course.get_location_type_display }}</span>
            <span>{{ course.get_days_display }}{% if course.specific_days %} ({{ course.specific_days }}) {% endif %}</span>
            <span>{{ course.get_group_size_display }}</span>
        </div>
        <p><strong>Местоположение:</strong> {{ course.teacher.location|default:"Не указано" }}</p>
        <p><strong>Контакты:</strong></p>
        <ul>
            <li>Instagram: {{ course.teacher.instagram|default:"Не указан" }}</li>
            <li>Telegram: {{ course.teacher.telegram|default:"Не указан" }}</li>
            <li>WhatsApp: {{ course.teacher.whatsapp|default:"Не указан" }}</li>
        </ul>
        <p><strong>Дата создания:</strong> {{ course.created_at }}</p>
    </div>

    <div class="reviews">
        <h2>Отзывы</h2>
        {% if messages %}
            {% for message in messages %}
                <p {% if message.tags %}class="{{ message.tags }}"{% endif %}>{{ message }}</p>
            {% endfor %}
        {% endif %}
        {% if form %}
            <div class="review-form">
                <h3>{% if user_review %}Редактировать отзыв{% else %}Оставить отзыв{% endif %}</h3>
                <form method="post">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit">{% if user_review %}Сохранить изменения{% else %}Отправить отзыв{% endif %}</button>
                </form>
            </div>
        {% endif %}
        {% if reviews %}
            {% for review in reviews %}
                <div class="review">
                    <p><strong>{{ review.student.fullname }}</strong> (Оценка: {{ review.rating }}/5)</p>
                    <p>{{ review.comment }}</p>
                    <p><small>{{ review.created_at }}</small></p>
                </div>
            {% endfor %}
        {% else %}
            <p>Отзывов пока нет.</p>
        {% endif %}
    </div>

    <p><a href="{% url 'all_courses' %}">Вернуться к списку курсов</a></p>
    <p><a href="{% url 'profile' %}">Вернуться в профиль</a></p>
</body>
</html>